<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Visual IG Grid Widget</title>
  <style>
    :root{ --gap:6px; --radius:8px; --columns:3; --shadow:0 0 0 rgba(0,0,0,0); --bg:transparent; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{display:flex;align-items:center;justify-content:center;min-height:100%;padding:8px}
    .grid{width:100%;max-width:1200px;display:grid;grid-template-columns:repeat(var(--columns),1fr);gap:var(--gap)}
    .card{position:relative;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);background:#eee;aspect-ratio:1/1}
    .card img{width:100%;height:100%;object-fit:cover;display:block}
    .label{position:absolute;left:6px;bottom:6px;background:rgba(0,0,0,.6);color:#fff;padding:4px 6px;border-radius:6px;font-size:12px;line-height:1;max-width:95%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .refresh{position:fixed;top:10px;left:10px;display:none;gap:6px;align-items:center;background:#111;color:#fff;border:0;border-radius:10px;padding:8px 10px;font-size:13px;cursor:pointer;box-shadow:0 10px 20px rgba(0,0,0,.12);opacity:.9}
    .refresh svg{width:16px;height:16px}
    .header{position:fixed;top:8px;right:8px;background:rgba(255,255,255,.9);padding:8px 10px;border-radius:10px;border:1px solid #ddd;box-shadow:0 10px 20px rgba(0,0,0,.08);font-size:13px;display:none;z-index:2}
    .header input{width:72px;padding:4px;font-size:12px}
    .header .wide{width:360px}
  </style>
</head>
<body>
  <button class="refresh" id="refreshBtn" title="Refresh">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12a9 9 0 1 1-3-6.7"/><path d="M21 3v7h-7"/>
    </svg>
    Refresh
  </button>
  <div class="wrap">
    <div class="grid" id="grid" aria-label="Instagram-style grid"></div>
  </div>
  <div class="header" id="panel">
    <strong>IG Grid Widget (edit mode)</strong><br>
    Columns <input id="cols" type="number" min="1" max="12" value="3">
    Gap(px) <input id="gap" type="number" min="0" max="40" value="6">
    Radius(px) <input id="rad" type="number" min="0" max="40" value="8">
    <label><input id="shadow" type="checkbox"> Shadow</label>
    <label><input id="reverse" type="checkbox"> Reverse order</label>
    <br>Images (| separated URLs):<br>
    <input id="imgs" class="wide" placeholder="https://...|https://...|https://...">
    <br>Labels (optional, | separated):<br>
    <input id="labels" class="wide" placeholder="Draft|Scheduled|Posted">
    <br><button id="apply">Apply</button>
  </div>
<script>
const qs=new URLSearchParams(window.location.search);
function getArray(n){const v=qs.get(n);if(!v)return[];return v.split('|').map(s=>decodeURIComponent(s.trim())).filter(Boolean);}
const config={imgs:getArray('imgs'),labels:getArray('labels'),cols:parseInt(qs.get('cols')||'3',10),gap:parseInt(qs.get('gap')||'6',10),radius:parseInt(qs.get('radius')||'8',10),shadow:qs.get('shadow')==='1',reverse:qs.get('reverse')==='1',bg:qs.get('bg')?decodeURIComponent(qs.get('bg')):'transparent',src:qs.get('src'),edit:qs.get('edit')==='1',refresh:qs.get('refresh')==='1'};
function applyTheme(){document.documentElement.style.setProperty('--columns',Math.max(1,Math.min(12,config.cols)));document.documentElement.style.setProperty('--gap',config.gap+'px');document.documentElement.style.setProperty('--radius',config.radius+'px');document.documentElement.style.setProperty('--bg',config.bg);document.documentElement.style.setProperty('--shadow',config.shadow?'0 10px 20px rgba(0,0,0,.08)':'0 0 0 rgba(0,0,0,0)');}
applyTheme();
async function loadFromSrc(nc=false){if(!config.src)return false;try{const url=new URL(config.src,window.location.href);if(nc){url.searchParams.set('_',Date.now());}const res=await fetch(url,{cache:'no-store'});const data=await res.json();const urls=[];const labels=[];(data||[]).forEach(it=>{if(it&&(it.url||it.src)){urls.push(it.url||it.src);labels.push(it.label||'');}});if(urls.length){config.imgs=urls;config.labels=labels;return true;}}catch(e){console.warn('Failed to load src JSON',e);}return false;}
function render(){const grid=document.getElementById('grid');grid.innerHTML='';let arr=config.imgs.map((u,i)=>({url:u,label:config.labels[i]||''}));if(config.reverse)arr=arr.reverse();arr.forEach(item=>{const card=document.createElement('div');card.className='card';const img=document.createElement('img');img.loading='lazy';img.src=item.url;img.alt='grid image';card.appendChild(img);if(item.label){const lab=document.createElement('div');lab.className='label';lab.textContent=item.label;card.appendChild(lab);}grid.appendChild(card);});}
function initPanel(){const p=document.getElementById('panel');if(!config.edit)return;p.style.display='block';cols.value=config.cols;gap.value=config.gap;rad.value=config.radius;shadow.checked=config.shadow;reverse.checked=config.reverse;imgs.value=config.imgs.join('|');labels.value=config.labels.join('|');apply.onclick=()=>{config.cols=parseInt(cols.value,10);config.gap=parseInt(gap.value,10);config.radius=parseInt(rad.value,10);config.shadow=shadow.checked;config.reverse=reverse.checked;config.imgs=imgs.value.split('|').filter(Boolean);config.labels=labels.value.split('|');applyTheme();render();};}
function initRefresh(){const btn=document.getElementById('refreshBtn');if(!config.refresh)return;btn.style.display='inline-flex';btn.onclick=async()=>{await loadFromSrc(true);render();};}
(async function start(){await loadFromSrc();initPanel();initRefresh();render();})();
</script>
</body>
</html>
